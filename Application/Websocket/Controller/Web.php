<?php
/**
 * Created by PhpStorm.
 * User: dongkai
 * Date: 2018/4/3
 * Time: 下午1:56
 */
namespace  App\Websocket\Controller;

use App\Models\DataCenter;
use App\Task\Mass;
use EasySwoole\Core\Component\Cluster\Server\ServerManager;
use EasySwoole\Core\Socket\AbstractInterface\WebSocketController;
use EasySwoole\Core\Swoole\Task\TaskManager;

class Web extends WebSocketController
{
    function actionNotFound(?string $actionName)
    {
        parent::actionNotFound($actionName); // TODO: Change the autogenerated stub

        $m = new DataCenter();
        $m->saveClient();
        $this->response()->write("192.168.10.10");
    }
    function index()
    {
        $this->response()->write("123");

    }

    /**
     * 向所有人推送的控制器
     */
    public function pp()
    {
        $dataCenter = new DataCenter();
        $fds = $dataCenter->getMyFd(); //获取我所有的Fd
        foreach ($fds as $fd) {
            $massTemplate = new Mass(['fd' => $fd,'data' => 11,]);
            TaskManager::async($massTemplate);
        }


//        $this->response()->write();
    }

}